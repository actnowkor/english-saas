# âœ… í…Œì´ë¸” ìµœì¢… ì •ë¦¬

## 1) `users`

> ì—…ë°ì´íŠ¸(2025-09-10): ì±„ì  ì •ê·œí™”/ê²°ê³¼ ì§‘ê³„/ì¤‘ë³µ ì‹œë„/ë³´ì•ˆ ì •ì±… ë³´ê°• ìš”ì•½ì€ ë³¸ ë¬¸ì„œ í•˜ë‹¨ "ì±„ì /ê²°ê³¼/ì¤‘ë³µ ì‹œë„ ì •ì±… ì—…ë°ì´íŠ¸" ì ˆì„ ì°¸ê³ í•˜ì„¸ìš”.

* í•µì‹¬ í•„ë“œ: `id`, `display_name`, `preferred_level`, `goal_minutes_per_day`, `created_at`
* ìš©ë„: ê°œì¸ ì»¨í…ìŠ¤íŠ¸(ì¶œì œ ì´ˆê¸°ê°’), ëŒ€ì‹œë³´ë“œ ì§‘ê³„

ì¢‹ì•„ìš”. â€œì˜¨ë³´ë”©ì€ ìµœì´ˆ 1íšŒë§Œ ë…¸ì¶œâ€ë¡œ ë°”ê¾¸ëŠ” ê±¸ ê¸°ì¤€ìœ¼ë¡œ, ì½”ë“œ ì—†ì´ ë‹¨ê³„ë³„ë¡œ ì •ë¦¬í•´ë“œë¦´ê²Œìš”. (ë§ì”€í•˜ì‹  ëŒ€ë¡œ â€œì„ í˜¸ ë ˆë²¨â€ì´ ì•„ë‹ˆë¼ â€œí˜„ì¬ ë ˆë²¨(current level)â€ì„ ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨í•©ë‹ˆë‹¤.)

# 1) ë°ì´í„°ë² ì´ìŠ¤ ë³€ê²½(ìŠ¤í‚¤ë§ˆ/ë§ˆì´ê·¸ë ˆì´ì…˜)

1. `users`(ë˜ëŠ” `profiles`) í…Œì´ë¸”ì— ì»¬ëŸ¼ ì¶”ê°€

* `current_level` (INT, NULL í—ˆìš©)

  * ì˜ë¯¸: ìœ ì €ì˜ í˜„ì¬ í•™ìŠµ ë ˆë²¨. **NULLì´ë©´ ì•„ì§ ì˜¨ë³´ë”© ë¯¸ì™„ë£Œ**ë¡œ ê°„ì£¼.
  * ì˜¨ë³´ë”© ì™„ë£Œ ì‹œ ìµœì´ˆ 1íšŒ ê°’ì´ ì„¸íŒ…ë¨. ì´í›„ì—ëŠ” ì„œë¹„ìŠ¤ ë¡œì§ì— ë”°ë¼ ì—…ë°ì´íŠ¸ë  ìˆ˜ ìˆìŒ.
* (ì„ íƒ) `onboarded_at` (TIMESTAMP, NULL í—ˆìš©)

  * ì˜ë¯¸: ì˜¨ë³´ë”© ì™„ë£Œ ì‹œê°(ì¶”ì /ë¶„ì„ìš©). ì˜¨ë³´ë”© ì œì–´ëŠ” `current_level`ë§Œìœ¼ë¡œë„ ì¶©ë¶„í•˜ì§€ë§Œ, ìš´ì˜/ë¡œê·¸ ë¶„ì„ì„ ìœ„í•´ ì¶”ì²œ.

2. ì´ˆê¸° ë°ì´í„° ìƒíƒœ

* ê¸°ì¡´ ìœ ì €: ê¸°ë³¸ê°’ `current_level = NULL` (ë‹¤ìŒ ë¡œê·¸ì¸ ì‹œ ì˜¨ë³´ë”©ìœ¼ë¡œ ìœ ë„ë¨)
* ì‹ ê·œ ìœ ì €: íšŒì›ê°€ì… â†’ í”„ë¡œí•„ ìƒì„± ì‹œ `current_level = NULL`ë¡œ ì‹œì‘

3. RLS/ê¶Œí•œ

* ìœ ì €ê°€ **ìê¸° ìì‹ ì˜** `current_level`ë§Œ ì½ê³ /ìˆ˜ì • ê°€ëŠ¥í•˜ë„ë¡ ê¸°ì¡´ RLS ì •ì±…ì— read/update ê¶Œí•œ í™•ì¸(ì •ì±…ì— â€œuser\_id = auth.uid()â€ ê°™ì€ ì†Œìœ ì ì¡°ê±´ í•„ìš”).
* ì¶”ê°€ ì»¬ëŸ¼ì´ RLSì— ë§‰íˆì§€ ì•Šë„ë¡ ì •ì±… ë²”ìœ„ì— í¬í•¨ë˜ëŠ”ì§€ ì ê²€.

# 2) ë°±ì—”ë“œ/ì„œë²„ ë¡œì§ ë³€ê²½

1. ë¡œê·¸ì¸ í›„ í”„ë¡œí•„ ì¡°íšŒ API/ì¿¼ë¦¬ì—ì„œ `current_level` í¬í•¨í•´ ì‘ë‹µ

* ì„¸ì…˜ì´ ìƒê¸°ë©´ `GET /me` ë˜ëŠ” `getUserProfile()`ì—ì„œ `current_level`ë¥¼ í•­ìƒ ë¦¬í„´.

2. ì˜¨ë³´ë”© ì™„ë£Œ ì²˜ë¦¬ ì—”ë“œí¬ì¸íŠ¸(ë˜ëŠ” ì•¡ì…˜)

* ì˜¨ë³´ë”© í™”ë©´ì—ì„œ ìµœì¢… â€œì‹œì‘í•˜ê¸°/ì™„ë£Œâ€ ì•¡ì…˜ ì‹œ:

  * `current_level`ì„ ìœ ì €ê°€ ì„ íƒ/íŒì •í•œ ê°’ìœ¼ë¡œ **ì—…ë°ì´íŠ¸**
  * (ì„ íƒ) `onboarded_at`ë„ í•¨ê»˜ ê¸°ë¡
  * ì •ìƒ ì €ì¥ë˜ë©´ ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

3. (ì„ íƒ) ë°ì´í„° ì •í•©ì„± ê°€ë“œ

* ì´ë¯¸ `current_level`ì´ ì„¤ì •ëœ ìœ ì €ê°€ ì˜¨ë³´ë”© ì™„ë£Œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•˜ë©´ **ë³€ê²½ ê¸ˆì§€** ë˜ëŠ” â€œì´ë¯¸ ì™„ë£Œë¨â€ ì—ëŸ¬/ë¬´ì‹œ ì²˜ë¦¬(ì›ì¹˜ ì•ŠëŠ” ë®ì–´ì“°ê¸° ë°©ì§€).

# 3) í”„ëŸ°íŠ¸ì—”ë“œ ë¼ìš°íŒ…/ê°€ë“œ ë³€ê²½

1. â€œë¡œê·¸ì¸ í›„ ìµœì´ˆ ì§„ì…â€ ê°€ë“œ

* ì•± ì´ˆê¸°í™” ì‹œì (ì˜ˆ: `_app`, `layout`, ì „ì—­ ê°€ë“œ, ë˜ëŠ” `/` ì§„ì… ì‹œ)ì—ì„œ **í”„ë¡œí•„ fetch â†’ `current_level` ì²´í¬**

  * `current_level === NULL` â†’ `/onboarding`ë¡œ ì´ë™
  * `current_level !== NULL` â†’ `/dashboard`ë¡œ ì´ë™

2. ì˜¨ë³´ë”© í˜ì´ì§€ ì§„ì… ê°€ë“œ

* ì´ë¯¸ ì˜¨ë³´ë”© ì™„ë£Œ(`current_level !== NULL`) ìƒíƒœì—ì„œ `/onboarding`ë¡œ ì ‘ê·¼ ì‹œ `/dashboard`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸(ì§ì ‘ URL ì…ë ¥ ë°©ì§€)

3. ìƒˆë¡œê³ ì¹¨/ì¬ì ‘ì† ì‹œ ë™ì‘

* ëª¨ë“  ë³´í˜¸ ë¼ìš°íŠ¸(ì˜ˆ: `/dashboard`, `/study` ë“±) ì§„ì… ì „ì— ê³µí†µìœ¼ë¡œ **í”„ë¡œí•„ ìƒíƒœë¥¼ ê°±ì‹ í•˜ì—¬** ìœ„ ê·œì¹™ ìœ ì§€
* ìºì‹œ/ìŠ¤í† ë¦¬ì§€ì— ì˜ì¡´í•˜ì§€ ë§ê³ , ì„¸ì…˜ì´ ìœ íš¨í•˜ë©´ ì„œë²„/DB ê¸°ì¤€ìœ¼ë¡œ íŒë³„

# 4) ë³€ê²½í•´ì•¼ í•  íŒŒì¼(ì˜ˆì‹œ êµ¬ì¡°)

> ì‹¤ì œ í´ë”/íŒŒì¼ëª…ì€ í˜„ì¬ í”„ë¡œì íŠ¸ êµ¬ì¡°ì— ë§ì¶° ì¡°ì •í•˜ì„¸ìš”.

* ë°±ì—”ë“œ/ê³µìš© API

  * `src/server/api/getUserProfile.(ts|js)` ë˜ëŠ” `src/lib/userProfile.(ts|js)`

    * `current_level`ì„ í¬í•¨í•´ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •
  * `src/server/api/completeOnboarding.(ts|js)`

    * ì˜¨ë³´ë”© ì™„ë£Œ ì‹œ `current_level` ì—…ë°ì´íŠ¸(+ `onboarded_at`) ì²˜ë¦¬

* í”„ëŸ°íŠ¸ì—”ë“œ ë¼ìš°íŒ…/ê°€ë“œ

  * `src/app/(root)/layout.(tsx|vue|jsx)` ë˜ëŠ” `_app`/ì „ì—­ ê°€ë“œ ì»´í¬ë„ŒíŠ¸

    * í”„ë¡œí•„ ë¡œë“œ â†’ `current_level` ê¸°ì¤€ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë¡œì§ ì¶”ê°€
  * `src/pages/onboarding.(tsx|vue|jsx)`

    * ì™„ë£Œ ì•¡ì…˜ì—ì„œ ì™„ë£Œ API í˜¸ì¶œ í›„ `/dashboard`ë¡œ ì´ë™
    * ì´ë¯¸ ì™„ë£Œ ìƒíƒœë©´ ë§ˆìš´íŠ¸ ì‹œ `/dashboard`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
  * `src/pages/dashboard.(tsx|vue|jsx)`

    * ë³„ë„ ë³€ê²½ ì—†ìŒ(ê°€ë“œì—ì„œ ê±¸ëŸ¬ì§)

* DB ë§ˆì´ê·¸ë ˆì´ì…˜/ëª¨ë¸

  * `supabase/migrations/xxxx_add_current_level.sql` (ë˜ëŠ” Prisma/Drizzle ë“±)

    * `current_level`(nullable), (ì„ íƒ)`onboarded_at` ì¶”ê°€
  * RLS/ì •ì±… íŒŒì¼

    * ë³¸ì¸ í–‰ë§Œ ì½ê¸°/ìˆ˜ì • ê°€ëŠ¥í•˜ë„ë¡ ì •ì±… í™•ì¸/ë³´ê°•

# 5) QA ì²´í¬ë¦¬ìŠ¤íŠ¸

* [ ] ì‹ ê·œ ê°€ì… â†’ ë¡œê·¸ì¸ â†’ ì˜¨ë³´ë”© ë…¸ì¶œ â†’ ì™„ë£Œ í›„ ëŒ€ì‹œë³´ë“œ ì§„ì…
* [ ] ìƒˆë¡œê³ ì¹¨/ë¸Œë¼ìš°ì € ì¬ì ‘ì†(ë‹¤ë¥¸ íƒ­ í¬í•¨) â†’ **ì˜¨ë³´ë”© ì¬ë…¸ì¶œ ì•ˆ ë¨**
* [ ] ì˜¨ë³´ë”© ë„ì¤‘ ì´íƒˆ í›„ ì¬ì ‘ì† â†’ ë‹¤ì‹œ ì˜¨ë³´ë”©ë¶€í„° ì‹œì‘(ë¯¸ì™„ì´ë¯€ë¡œ `current_level = NULL`)
* [ ] ì˜¨ë³´ë”© ì™„ë£Œ í›„ `/onboarding` ì§ì ‘ ì…ë ¥ â†’ ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
* [ ] RLS: ë³¸ì¸ë§Œ ìì‹ ì˜ `current_level` ì¡°íšŒ/ìˆ˜ì • ê°€ëŠ¥
* [ ] ê¸°ì¡´ ìœ ì €(ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ `NULL`)ë„ ì •ìƒì ìœ¼ë¡œ ì˜¨ë³´ë”© ìœ ë„

# 6) ë¡¤ì•„ì›ƒ/ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš

1. ìŠ¤í‚¤ë§ˆ ë°°í¬: `current_level`/`onboarded_at` ì»¬ëŸ¼ ì¶”ê°€
2. ë°±ì—”ë“œ ë°°í¬: í”„ë¡œí•„ ì‘ë‹µ/ì˜¨ë³´ë”© ì™„ë£Œ API ë°˜ì˜
3. í”„ëŸ°íŠ¸ ë°°í¬: ë¼ìš°íŒ… ê°€ë“œ/ì˜¨ë³´ë”© ì™„ë£Œ ì²˜ë¦¬ ë°˜ì˜
4. ì ê²€: ìš´ì˜ ì½˜ì†”ì—ì„œ ì„ì˜ ê³„ì •ìœ¼ë¡œ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
5. ëª¨ë‹ˆí„°ë§: ì˜¤ë¥˜ ë¡œê·¸, ì˜¨ë³´ë”© ì™„ë£Œìœ¨ ì§€í‘œ í™•ì¸

# 7) ê¸°íšì„œì— ì¶”ê°€í•  ë¬¸êµ¬(ë³µë¶™ìš©)


## ì˜¨ë³´ë”© ë…¸ì¶œ ê¸°ì¤€(ìµœì´ˆ 1íšŒ ì •ì±…)

* ëª©ì : ìœ ì €ì˜ **í˜„ì¬ í•™ìŠµ ë ˆë²¨**ì„ ìµœì´ˆ 1íšŒ ìˆ˜ì§‘í•˜ì—¬ ê°œì¸í™”ëœ ëŒ€ì‹œë³´ë“œë¥¼ ì œê³µí•œë‹¤.
* íŒë³„ ë¡œì§: `users.current_level`ì´ **NULLì´ë©´** ì˜¨ë³´ë”© í™”ë©´ì„ ë…¸ì¶œí•œë‹¤. ê°’ì´ ì¡´ì¬í•˜ë©´ ì˜¨ë³´ë”©ì„ **ì¬ë…¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤**.
* ìµœì´ˆ ì§„ì… íë¦„

  1. ë¡œê·¸ì¸ ì™„ë£Œ â†’ í”„ë¡œí•„ ì¡°íšŒ
  2. `current_level = NULL` â†’ ì˜¨ë³´ë”© ì§„ì…
  3. ìœ ì €ê°€ ë ˆë²¨ ì„ íƒ/íŒì • â†’ â€œì‹œì‘í•˜ê¸°â€
  4. ì„œë²„ì—ì„œ `current_level` ì €ì¥(í•„ìˆ˜), `onboarded_at` ì €ì¥(ì„ íƒ) â†’ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
* ì¬ì ‘ì†/ìƒˆë¡œê³ ì¹¨

  * ë¡œê·¸ì¸ ìƒíƒœì—ì„œ ì¬ì ‘ì† ì‹œ ì„œë²„ì˜ `current_level` ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ì¦‰ì‹œ ë¼ìš°íŒ…í•œë‹¤. (`NULL`ì´ ì•„ë‹ˆë©´ ëŒ€ì‹œë³´ë“œë¡œ ì§í–‰)
* ê°•ì œ ì ‘ê·¼ ì œì–´

  * ì˜¨ë³´ë”© ì™„ë£Œ(`current_level != NULL`) ìƒíƒœì—ì„œ `/onboarding` URL ì ‘ê·¼ ì‹œ ìë™ìœ¼ë¡œ ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•œë‹¤.
* ë°ì´í„° í•­ëª©

  * `current_level` (int, nullable): í˜„ì¬ í•™ìŠµ ë ˆë²¨. ì˜¨ë³´ë”© ì™„ë£Œ ì—¬ë¶€ì˜ íŒë³„ ê¸°ì¤€.
  * `onboarded_at` (timestamp, nullable, ì„ íƒ): ì˜¨ë³´ë”© ì™„ë£Œ ì‹œê°(ì§€í‘œ/ë¶„ì„ìš©).
* ì˜ˆì™¸ ë° ì—ëŸ¬ ì²˜ë¦¬

  * ì´ë¯¸ `current_level`ì´ ì¡´ì¬í•˜ëŠ” ê³„ì •ì€ ì˜¨ë³´ë”© ì™„ë£Œ API ìš”ì²­ì„ ë¬´ì‹œí•˜ê±°ë‚˜ â€œì´ë¯¸ ì™„ë£Œë¨â€ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•œë‹¤.
* ì§€í‘œ/ë¡œê·¸

  * ì˜¨ë³´ë”© ì§„ì…ë¥ , ì™„ë£Œìœ¨, í‰ê·  ì†Œìš” ì‹œê°„, ì´íƒˆ ë‹¨ê³„, ì˜¨ë³´ë”© í›„ 24ì‹œê°„ ë‚´ ì¬ë°©ë¬¸/í•™ìŠµ ì‹œì‘ë¥ ì„ ìˆ˜ì§‘í•œë‹¤.


ë ˆë²¨ì„ **ì˜¨ë³´ë”© ìµœì´ˆ 1íšŒ ìˆ˜ì§‘ + ì´í›„ í•™ìŠµ ê¸°ë¡ì— ë”°ë¼ ê°±ì‹ **í•˜ë ¤ë©´ ë‘ ê°€ì§€ í™•ì¥ì´ í•„ìš”í•©ë‹ˆë‹¤.

---

## 1. `users` í…Œì´ë¸” í™•ì¥

ì˜¨ë³´ë”© ì •ì±…ì— ë§ê²Œ í•„ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

* `current_level` (int, nullable):
  ì‚¬ìš©ìì˜ í˜„ì¬ í•™ìŠµ ë ˆë²¨.
  â†’ **ì˜¨ë³´ë”© ì—¬ë¶€ íŒë³„**(NULLì´ë©´ ì˜¨ë³´ë”© í•„ìš”).
  â†’ í•™ìŠµ/ë¼ì´íŠ¸ë„ˆ ë°ì´í„°ì™€ ë³„ê°œë¡œ **ëŒ€ì‹œë³´ë“œì— ë°”ë¡œ ë³´ì—¬ì¤„ í˜„ì¬ê°’**.

* `onboarded_at` (timestamp, nullable):
  ì˜¨ë³´ë”© ì™„ë£Œ ì‹œê°. ë¶„ì„ìš© ì§€í‘œ, ìµœì´ˆ ì§„ì… íë¦„ ê´€ë¦¬.

ğŸ’¡ ì´ë ‡ê²Œ í•˜ë©´ ë¡œê·¸ì¸ ì‹œ `current_level`ì´ NULLì¸ì§€ ì—¬ë¶€ë§Œ ì²´í¬í•˜ë©´ ë˜ê³ , `onboarding/page.tsx` (ì´ë¯¸ í´ë” êµ¬ì¡° ìˆìŒ)ì™€ ë°”ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.

---

## 2. ì‚¬ìš©ì ë ˆë²¨ ë³€í™” ê¸°ë¡ìš© ìƒˆ í…Œì´ë¸”

ë ˆë²¨ì€ ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ë³€í•  ìˆ˜ ìˆìœ¼ë‹ˆ **íˆìŠ¤í† ë¦¬ í…Œì´ë¸”**ì„ ë‘¬ì•¼ í•©ë‹ˆë‹¤.

### `user_level_history`

* `id` (uuid, pk)
* `user_id` (uuid, fk â†’ users.id)
* `level` (int, not null): ë³€ê²½ëœ ë ˆë²¨
* `source` (text): ë³€ê²½ ê·¼ê±° (ì˜ˆ: "onboarding", "auto\_assessment", "manual\_override")
* `changed_at` (timestamp, default now()): ë³€ê²½ ì‹œê°

ğŸ’¡ ì´ í…Œì´ë¸”ì— ëˆ„ì  ê¸°ë¡ì„ ìŒ“ì•„ë‘ë©´:

* ì˜¨ë³´ë”©ìœ¼ë¡œ ì‹œì‘í•œ ìµœì´ˆ ë ˆë²¨ ê¸°ë¡
* ì„¸ì…˜/ì •ë‹µë¥  ê¸°ë°˜ ìë™ ë ˆë²¨ ìƒí–¥Â·í•˜í–¥ ê¸°ë¡
* ê´€ë¦¬ìê°€ ìˆ˜ë™ ì¡°ì •í•œ ê²½ìš°ë„ ë‚¨ê¸¸ ìˆ˜ ìˆìŒ

---

## 3. ì—°ê³„ ë°©ì‹

1. **ì˜¨ë³´ë”© ìµœì´ˆ ì§„ì…**

   * `users.current_level = NULL` â†’ ì˜¨ë³´ë”© í™”ë©´ ë…¸ì¶œ
   * ìœ ì €ê°€ ë ˆë²¨ ì„ íƒ/íŒì • â†’ APIì—ì„œ `users.current_level`ê³¼ `users.onboarded_at` ì €ì¥
   * ë™ì‹œì— `user_level_history`ì— `"onboarding"` ì†ŒìŠ¤ë¡œ ê¸°ë¡ ì¶”ê°€

2. **í•™ìŠµ ì¤‘ ìë™ ê°±ì‹ **

   * ë¼ì´íŠ¸ë„ˆ/ì„¸ì…˜ ê²°ê³¼ ê¸°ë°˜ìœ¼ë¡œ ë ˆë²¨ì´ ë°”ë€Œë©´

     * `users.current_level` ì—…ë°ì´íŠ¸
     * `user_level_history`ì— `"auto_assessment"` ì†ŒìŠ¤ë¡œ ê¸°ë¡ ë‚¨ê¹€

3. **ëŒ€ì‹œë³´ë“œ/íˆìŠ¤í† ë¦¬**

   * í˜„ì¬ ë ˆë²¨ì€ `users.current_level`ë§Œ ë³´ë©´ ë¨
   * ê³¼ê±° ë³€í™”ë¥¼ ë³´ê³  ì‹¶ìœ¼ë©´ `user_level_history`ë¥¼ ì¡°íšŒ

---

## 4. ìš”ì•½

* `users`ì— **current\_level, onboarded\_at** í•„ë“œë¥¼ ì¶”ê°€
* ë ˆë²¨ ë³€í™”ë¥¼ ì¶”ì í•˜ê¸° ìœ„í•´ **user\_level\_history í…Œì´ë¸”**ì„ ì‹ ì„¤
* ì˜¨ë³´ë”©/ìë™ í‰ê°€/ê´€ë¦¬ì ì¡°ì • ëª¨ë‘ ì´ë ¥ì— ë‚¨ê¹€
* í”„ë¡ íŠ¸ëŠ” `users.current_level`ë¡œ í˜„ì¬ ë ˆë²¨ë§Œ ë¹ ë¥´ê²Œ í™•ì¸í•˜ê³ , `user_level_history`ëŠ” ë¶„ì„Â·UI í™•ì¥ìš©ìœ¼ë¡œ í™œìš©

    â€” ë³µë¶™ ë â€”


## 2) `items`  *(ë¬¸ì¥/phrase/ë‹¨ì–´ + AI/ì´ˆê¸°ë“±ë¡ í†µí•©)*

* í•µì‹¬ í•„ë“œ:
  `id`, `type(sentence|phrase|word)`, `level(L1~L9)`, `difficulty(1~5)`,
  `concept_key(ë¬¸ì¥ìš©)`, `family_key(ì‚¬ë‹¤ë¦¬ ë¬¶ìŒ)`,
  `source_ko`, `answer_en`, `allowed_variants_text`, `near_misses_text`,
  `tags`, `status(draft|approved|archived)`, `banked_at`, `reviewed_by`, `review_notes`,
  `parent_item_id(ì„ íƒ)`, `memo_json`, `created_at`, `updated_at`
* ìš©ë„: ì¶œì œ ì›ë³¸. **statusë¡œ ì€í–‰ í¸ì… ì—¬ë¶€ë§Œ ê´€ë¦¬**

## 3) `sessions`

* í•µì‹¬ í•„ë“œ:
  `id`, `user_id`, `status(in_progress|abandoned|completed)`,
  `target_item_count`, `started_at/ended_at/last_activity_at`,
  `restart_count`, `strategy_json`, `billing_note`
* ìš©ë„: í•œ íŒ ì§„í–‰/ê³¼ê¸ˆ/ì¬ì‹œì‘

## 4) `session_items`  *(ìŠ¤ëƒ…ìƒ·)*

* í•µì‹¬ í•„ë“œ: `id`, `session_id`, `item_id`, `order_index`, `snapshot_json`, `created_at`
* ìš©ë„: ë°°ì • ë‹¹ì‹œ **ì •ë‹µ/ë³€í˜•/ë ˆë²¨/ë‚œì´ë„/ê°œë…í‚¤/í‘œì‹œë¬¸êµ¬** ë™ê²° â†’ ì±„ì Â·ì¬í˜„ ê¸°ì¤€

## 5) `attempts`

* í•µì‹¬ í•„ë“œ: `id`, `session_id`, `item_id`, `answer_raw`, `latency_ms`, `submitted_at`
* ìš©ë„: ì‚¬ìš©ìì˜ ì‹¤ì œ ì œì¶œ

## 6) `grades`  *(attempts 1:1)*

* í•µì‹¬ í•„ë“œ:
  `attempt_id`, `label(correct|variant|near_miss|wrong)`,
  `error_tags`, `feedback_short`, `minimal_rewrite`, `role_view_text`,
  `judge(rule|ai)`, `evidence_json`, `created_at`
* ìš©ë„: íŒì •/ì§§ì€ í”¼ë“œë°±/ì˜¤ë¥˜ íƒœê¹…

## 7) `user_item_status`  *(ì•„ì´í…œ ë¼ì´íŠ¸ë„ˆ: phrase/word ì „ìš©)*

* í•µì‹¬ í•„ë“œ:
  `user_id`, `item_id`, `box_level`, `last_attempt_at`, `next_due_at`,
  `interval_days`, `streak`, `total_attempts`, `correct_count`, `wrong_count`,
  `last_result`, `last_session_id`, `created_at`
* ìš©ë„: ë‹¨ì–´Â·ë¬¸êµ¬ ë³µìŠµ ìŠ¤ì¼€ì¤„

## 8) `user_concept_status`  *(ê°œë… ë¼ì´íŠ¸ë„ˆ: ë¬¸ì¥ ì „ìš©)*

* í•µì‹¬ í•„ë“œ:
  `user_id`, `concept_key`, `box_level`, `last_attempt_at`, `next_due_at`,
  `interval_days`, `streak`, `total_attempts`, `correct_count`, `wrong_count`,
  `last_result`, `last_session_id`, `preferred_difficulty`, `created_at`
* ìš©ë„: ë¬¸ì¥ ê°œë… ë³µìŠµ + ë‚œì´ë„(ì‚¬ë‹¤ë¦¬) ìë™ì¡°ì ˆ

## 9) `concepts` *(ì„ íƒ)*

* í•µì‹¬ í•„ë“œ: `concept_key`, `display_name`, `description`, `level_range`, `recommended_difficulty_start`, `tags`
* ìš©ë„: UI ì„¤ëª…/ê²€ìƒ‰ í’ˆì§ˆ(ì—†ì–´ë„ ìš´ì˜ ê°€ëŠ¥)

---

# ğŸ§© â€œìˆ˜ë™ ì¤€ë¹„ vs AIë¡œ ìƒì„±í•´ ì¤€ë¹„ vs ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë³€ê²½â€ êµ¬ë¶„

ì•„ë˜ëŠ” **ê° í…Œì´ë¸”/í•„ë“œ ê¸°ì¤€ìœ¼ë¡œ ëˆ„ê°€ ë§Œë“¤ê³  ì–¸ì œ ë°”ë€ŒëŠ”ì§€**ë¥¼ í•œëˆˆì—.

## A) **ìˆ˜ë™ìœ¼ë¡œ ì¤€ë¹„(ìµœì¢… ê²°ì •ê°’)** â€” *AIë¡œ ì´ˆì•ˆ ìƒì„± ê°€ëŠ¥*

* **í‚¤/ë¶„ë¥˜/ì •ì±…**

  * `items.concept_key`, `items.family_key`  â† *AI ì œì•ˆ ê°€ëŠ¥, ìµœì¢… ìˆ˜ë™ í™•ì •*
  * ë‚œì´ë„ ì‚¬ë‹¤ë¦¬ ê·œì¹™(ê°œë…ë³„ difficulty 1â†’5 ì„¤ê³„)
  * **ì—ëŸ¬ íƒœê·¸ ì¹´íƒˆë¡œê·¸**(ì˜ˆ: `preposition_error`, `article_missing`, â€¦)
  * **ì±„ì  ê·œì¹™**(ì •ê·œí™”, ì¶•ì•½ í—ˆìš©, ê´€ì‚¬ ì •ì±…, phrase ë¬¸ì¥ê¸ˆì§€)
  * **ë¼ì´íŠ¸ë„ˆ ê°„ê²©í‘œ**(ë°•ìŠ¤ë³„ ì¼ìˆ˜, ìƒÂ·í•˜í–¥ ì¡°ê±´)
  * **ì¶œì œ ì „ëµ ë””í´íŠ¸**(due/ì•½ì /ì‹ ê·œ ê°€ì¤‘, ë¬¸ì¥\:phrase ë¹„ìœ¨)
  * **ì•ˆì „Â·ê¸ˆì¹™ ë¦¬ìŠ¤íŠ¸**(ìƒì„± ê¸ˆì§€ í‚¤ì›Œë“œ)

* **ì½˜í…ì¸  ê²€ìˆ˜/ì€í–‰ í¸ì…**

  * `items.status` ì „í™˜(`draft â†’ approved`), `banked_at`, `reviewed_by`, `review_notes`
  * (ì„ íƒ) `parent_item_id`ë¡œ ë²„ì „/ìŠ¹ê²© ì—°ê²°

> **AIë¡œ ìƒì„±í•´ ì¤€ë¹„í•  ìˆ˜ ìˆëŠ” ê²ƒ(ì´ˆì•ˆ â†’ ì‚¬ëŒì´ í™•ì •)**
>
> * `items.source_ko`, `items.answer_en`
> * `allowed_variants_text`, `near_misses_text`(ì‚¬ìœ  í¬í•¨)
> * `memo_json`(roles íƒœê¹…/ìƒì„± í”„ë¡¬í”„íŠ¸/ê²€ì¦ ë¡œê·¸)
> * `tags`(AI ìë™ íƒœê¹… â†’ í‘œì¤€ íƒœê·¸ë¡œ ë‹¤ë“¬ê¸°)
> * `concepts.description`/ì˜ˆë¬¸(ì„ íƒ í…Œì´ë¸” ì±„ìš¸ ë•Œ)

## B) **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì˜í•´ ë³€ê²½(ëŸ°íƒ€ì„ ìë™ ê°±ì‹ )**

* `session_items.snapshot_json`  *(ë°°ì • ì‹œ ìë™ ìƒì„±Â·ë™ê²°)*
* `attempts.*`  *(ì‚¬ìš©ì ì œì¶œ ì‹œ ìƒì„±)*
* `grades.*`  *(ê·œì¹™ ì±„ì  â†’ ë¶ˆí™•ì‹¤ ì‹œ AI ë³´ì¡°, ì €ì¥)*
* **ë¼ì´íŠ¸ë„ˆ ê°±ì‹ **

  * `user_item_status.*` (phrase/word) â†’ ì •ë‹µ/ì˜¤ë‹µì— ë”°ë¼ `box_level`, `next_due_at`, `interval_days`, ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
  * `user_concept_status.*` (ë¬¸ì¥) â†’ ìƒë™ + `preferred_difficulty` ìƒÂ·í•˜í–¥(ê°€ë“œ í¬í•¨)
* `sessions.status/last_activity_at/restart_count/ended_at`  *(ì§„í–‰/ì¤‘ë‹¨/ì™„ë£Œ/ì¬ì‹œì‘ì— ë”°ë¼ ë³€ê²½)*

---

# ğŸ“Œ ìš´ì˜ ì²´í¬ í¬ì¸íŠ¸ (ìš”ì•½)

* **ì€í–‰ í¸ì… ê¸°ì¤€ì€ `items.status`ë§Œ**: `draft`(ë°”ë¡œ ì¶œì œ ê°€ëŠ¥, ìŠ¤ëƒ…ìƒ· ë³´ì¥) â†’ `approved`(ì€í–‰) â†’ `archived`
* **ë¬¸ì¥=ê°œë… ë¼ì´íŠ¸ë„ˆ**, **phrase/word=ì•„ì´í…œ ë¼ì´íŠ¸ë„ˆ**
* **ì±„ì ì€ í•­ìƒ `session_items.snapshot_json` ê¸°ì¤€**(ì¬í˜„ì„±)
* **AIëŠ” ì´ˆì•ˆÂ·ë³´ì¡°** / **ìµœì¢… í‚¤Â·ì •ì±…Â·ìŠ¹ê²©ì€ ìˆ˜ë™ í™•ì •**

ì´ êµ¬ì„±ìœ¼ë¡œ **ëŒ€ì‹œë³´ë“œ, ì¶œì œ/ì±„ì , ë³µìŠµ, ì€í–‰ í¸ì…** ëª¨ë‘ ê¹”ë”í•˜ê²Œ ëŒì•„ê°‘ë‹ˆë‹¤.
